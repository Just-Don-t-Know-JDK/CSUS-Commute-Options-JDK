<!-- Dane & Ethan -->

<!--
    I think we will probably have a navbar for the entire site, so maybe we include the graph options
    as a jumbotron-form where you can checkbox new commute methods to compare.
    Maybe this can instead just be another navbar that could be vertical on the left and the same form format.
-->
<!doctype html>
<html lang="en">
    <head>
        <!-- Meta Tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

        <title>Data Analysis</title>

        <style>
            html{ overflow-y: scroll; }
        </style>
    </head>
    <body>

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #043927;">
            <div class="container">
            <a class="navbar-brand" href="#">Sacramento State Traffic Sustainability</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                  <a class="nav-link" href="#">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">About</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Resources & Info
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Transit</a>
                    <a class="dropdown-item" href="#">RideShare</a>
                  </div>
                </li>
              </ul>
            </div>
            </div>
        </nav>

        <nav class="navbar-expand-lg navbar-dark" style="background-color: gold; padding: 10px;">
            <div class="container">
                <form id="option" class="form">

                    <div class="form-group">
                        <label>Cost Comparison type</label>
                        <select id="parent" class="form-control">
                            <option value="sustainability">Sustainability</option>
                            <option value="time">Time</option>
                            <option value="money">Money</option>
                        </select>
                    </div>

                    <div class="form-group ml-auto">
                        <label>Second Bar</label>
                        <select id="second" class="form-control">
                            <option value="SOV">Single Occupant Vehicle</option>
                            <option value="MOV">Multi-Occupant Vehicle</option>
                            <option value="Motorcycle">Motorcycle</option>
                            <option value="Transit">Transit</option>
                            <option value="Bicycle">Bicycle</option>
                            <option value="Walking">Walking</option>
                        </select>
                    </div>

                </form>
            </div>
        </nav>
        
        <main class="col bg-faded py-3 mx-auto" style="width: 1200px;">
            <canvas class="my-4 chartjs-render-monitor" id="myChart" width="554" height="233" style="display: block; width: 554px; height: 233px;">
        </main>

        <div class="container" style="background-color: gold; width: 1000px;">
            <div class="row">
                <div class="col-5 mx-auto" style="text-align: center;">
                    <h2 id="head1">Sustainability</h2>
                    <br>
                </div>
                <div class="col-5 mx-auto" style="text-align: center;">
                    <h2 id="head2">Single Occupant Vehicle</h2>
                </div>
            </div>
            <div class="row justify-content-around">
                <div class="col-5 mx-auto" style="text-align: center;">
                    <p id="p1">The sustainability of a commute mode represents its impact on the environment. To come to our calculations for each mode, 
                        we took the averages of each mode's miles per gallon alongside your inputted data to determine how much you would on average
                        impact the environment with the given mode.
                    </p>
                </div>
                <div class="col-5 mx-auto" style="text-align: center;">
                    <p id="p2">The single occupant vehicle carbon consumption per year with your given inputs would be </p>
                </div>
            </div>
        </div>

        <div style="height: 200px;"></div>
        
        
        
        <!-- Other Stuff -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <!-- Charts.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script>
            let userData = JSON.parse(window.localStorage.getItem('userData')); // Fetching the user data from previous page
            
            // TODO - Compress
            function sustainabilityCalc(mpg, distance, freq) {
                let emissionPerMile = (8887/mpg)*distance*2.0; // times 2 becasue you have to come back home :)
                let wkConsumtion = emissionPerMile * freq;
                let yrConsumption = wkConsumtion * 52.0;
                
                return ((yrConsumption/1000)*2.205)/1000; // Yearly carbon emissions in tons per year
            }

            /*
            let graphInfo = {
                sustainVals: [
                    sustainabilityCalc(userData.mpg, userData.distance, userData.freq), // Users consumption
                    sustainabilityCalc(24.2, userData.distance, userData.freq),         // SOV
                    sustainabilityCalc(25.50, userData.distance, userData.freq),        // MOV
                    sustainabilityCalc(44, userData.distance, userData.freq),           // Motorcycle
                    sustainabilityCalc(5.18, userData.distance, userData.freq),         // Transit (Have to consider individual responsibility)
                    0,                                                                  // Bike
                    0                                                                   // Walking
                    ],
                timeVals: userData.time,                                                // Could be hard to get all these
                moneyVals: [            // All is yearly
                    userData.money,
                    6201.0,             // SOV (sources in google drive)
                    6201.0,             // MOV (can be split, sole, or no responsibility)
                    1500.0,             // Motorcycle (from https://www.nadaguides.com/Motorcycles/shopping-guides/how-much-does-it-cost-to-service-a-motorcycle#:~:text=Just%20as%20new%20and%20used,it%20in%2C%20and%20so%20on.)
                    700.0,              // Transit (from https://www.usatoday.com/story/money/2018/09/25/transportation-costs-cities-most-expensive/37866627/)
                    350.0,              // Bike (from https://www.treehugger.com/how-much-does-it-cost-to-commute-by-bike-4858452#:~:text=Based%20on%20an%20annual%20average,or%203.84%20minutes%20a%20day.)
                    0                   // Walking (costs shoes but w/e)
                ]
            } */

            // Testing array
            let graphInfo = {
                sustainVals: [
                    4.7,
                    5.1,
                    4.8,
                    2.8,
                    24.0,
                    0,
                    0
                ],
                timeVals: [
                    131.7,
                    131.7,
                    131.7,
                    131.7,
                    526.9,
                    644.8,
                    2260.3
                ],
                moneyVals: [
                    6201.0,
                    6201.0,
                    6201.0,
                    1500.0,
                    700.0,
                    350.0,
                    0
                ]
            }

            var ctx = document.getElementById("myChart");
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["Your Values", $('#second option:selected').text()],
                    datasets: [{
                        data: [graphInfo.sustainVals[0], graphInfo.sustainVals[1]],
                        backgroundColor: ["#dad9u","#3e95cd"],
                        barPercentage: 0.5,
                        barThickness: 6,
                        maxBarThickness: 8,
                        minBarLength: 2
                    }]
                },
                options: {
                    legend: {   display: false  },
                    title: {
                        display: true,
                        text: 'Carbon Consumption (tons/yr)'
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });

            function secondOptionSwitch() {
                myChart.data.labels = ['Your Values', $('#second option:selected').text()];
                changeCompare($('#second option:selected').text(), 1, getType($('#parent option:selected').text()));
                myChart.update();
            }

            $('#parent').change(function(){
                if ($('#parent option:selected').text() == 'Sustainability') {
                    myChart.options.title.text = 'Carbon Consumption (tons/yr)';
                    $("#p1").html(
                        `
                        The sustainability of a commute mode represents its impact on the environment. To come to our calculations for each mode, 
                        we took the averages of each mode's miles per gallon alongside your inputted data to determine how much you would on average
                        impact the environment with the given mode.
                        `
                    );
                }
                else if ($('#parent option:selected').text() == 'Time') {
                    myChart.options.title.text = 'Time Traveled Yearly';
                    $("#p1").html(
                        `
                        The time concerns of a commute mode are the amount of time that we predict this commute mode to take in your situation.
                        To calculate this, we used an algorithm to determine the fastest route you would take to get to Sacramento State and how many times
                        you would commute a week and then upscaled the data to a yearly scale.
                        `
                    );
                }
                else if ($('#parent option:selected').text() == 'Money') {
                    myChart.options.title.text = 'Travel Cost in Dollars per Year';
                    $("#p1").html(
                        `
                        The money concerns of a commute mode is just how much it will cost you to pay for your typical commute on a yearly scale.
                        `
                    );
                }

                changeCompare('Your Values', 0, getType($('#parent option:selected').text()));
                secondOptionSwitch();
                myChart.update();
                $("#head1").html($('#parent option:selected').text());
            });

            function getType(value) {
                if (value == 'Sustainability')
                    return graphInfo.sustainVals;
                else if (value == 'Time')
                    return graphInfo.timeVals;
                else if (value == 'Money')
                    return graphInfo.moneyVals;
            }

            function changeCompare(value, index, array) {
                if (value == 'Your Values')
                    myChart.data.datasets[0].data[index] = array[0];
                else if (value == 'Single Occupant Vehicle')
                    myChart.data.datasets[0].data[index] = array[1];
                else if (value == 'Multi-Occupant Vehicle')
                    myChart.data.datasets[0].data[index] = array[2];
                else if (value == 'Motorcycle')
                    myChart.data.datasets[0].data[index]= array[3];
                else if (value == 'Transit')
                    myChart.data.datasets[0].data[index] = array[4];
                else if (value == 'Bicycle')
                    myChart.data.datasets[0].data[index] = array[5];
                else if (value == 'Walking')
                    myChart.data.datasets[0].data[index] = array[6];
            }

            $('#second').change(function(){
                $('#head2').html($('#second option:selected').text());
                
                secondOptionSwitch();
            });
        </script>
    </body>
</html>